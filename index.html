<!-- https://mc5x5rqks68-f67k0fy4h7dd59w1.pub.sfmc-content.com/vs4am0o4mfp -->

<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link rel="stylesheet" href="%%=CloudPagesURL(7961)=%%">


    <title>delete form</title>

    <link rel="shortcut icon" type="image/x-icon"
        href="https://image.s10.sfmc-content.com/lib/fe4715707564047e761471/m/1/e47a902b-80db-48dc-bc12-57f995bce5bf.png" />
    <script runat=server>
        Platform.Response.SetResponseHeader("Strict-Transport-Security", "max-age=200");
        Platform.Response.SetResponseHeader("X-XSS-Protection", "1; mode=block");
        Platform.Response.SetResponseHeader("X-Frame-Options", "Deny");
        Platform.Response.SetResponseHeader("X-Content-Type-Options", "nosniff");
        Platform.Response.SetResponseHeader("Referrer-Policy", "strict-origin-when-cross-origin");
        Platform.Response.SetResponseHeader("Content-Security-Policy", "default-src 'self' https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css https://image.s10.sfmc-content.com/lib/fe4715707564047e761471/m/1/e47a902b-80db-48dc-bc12-57f995bce5bf.png");
    </script>

  
</head>

<body class="d-flex flex-column vh-100">

    <header class=" text-center bg-transparent text-white  d-flex align-items-center justify-content-center mb-md-5">
        <h1 class="display-3 font-weight-bold">Subscriber delete form: </h1>
    </header>

    <section class="text-center  d-flex flex-column align-items-center justify-content-center">


        <script runat="server">

            Platform.Load("core", "1");

            var options = {
                "DataExtension": "autoGeneratedForm"
            }

            var attributes = {
                "subscriberkey": {
                    "Type": "Text",
                    "Pattern": "",
                    "Label": "subscriberkey",
                    "Required": true,
                    "Placeholder": "Enter subscriberkey"
                },

                "reason": {
                    "Type": "reason",
                    "Pattern": "",
                    "Label": "reason",
                    "Required": false,
                    "Placeholder": "Enter reason"
                }

            }

            var submit = (Request.Method() == "POST") ? true : false;
            var success = (!!isNotEmpty(Request.GetQueryStringParameter("success"))) ? true : false;
            if (success) {
                var successValue = Request.GetQueryStringParameter("success") == 1 ? true : false;
            }
            if (!!submit) {

                var rows = insertInDataExtension(options);
                if (rows === 1) {
                    Redirect(getPageURL() + "?success=1", true);
                }
                else {
                    Redirect(getPageURL() + "?success=0", true);
                }


            } else if (!!success) {
                if (successValue == true) {
                    Write("<strong class='h2'>Thank you for submitting</strong><br><a class='h2' href='" + getPageURL() + "'>Restart</a>");
                }
                else {
                    Write("<strong class='h2'>Sorry, something went wrong.</strong><br><a class='h2' href='" + getPageURL() + "'>Restart</a>");
                }

            } else {

                buildForm(options, attributes);

            }

            function insertInDataExtension(options) {

                var fields = {};
                var list = getFieldNames(options.DataExtension);
                var de_name = options.DataExtension;

                for (n in list) {
                    var name = list[n];
                    var val = (Request.GetFormField(list[n]) != null) ? Request.GetFormField(list[n]) : "";
                    fields[name] = val;
                }

                fields["Id"] = timestamp();

                var insert = splitKeysValues(fields);

                var rows = Platform.Function.InsertData(de_name, insert.Keys, insert.Values);

                return rows;

            }

            function buildForm(options, attributes) {

                var html = "";
                var fields = getFieldNames(options.DataExtension);

                html += "<form action='" + getPageURL() + "' method='post' class=' border rounded border-info bg-info p-1 p-md-3 m-1 mt-md-1 mr-md-5 ml-md-5 mb-md-0 col col-11 col-md-6 text-center'>";
                html += buildFields(fields, attributes);
                html += "<br>";
                html += "<button class=' btn-light  text-info rounded align-self-center'>Send</button>";
                html += "</form>";

                Write(html);

            }

            function buildFields(fields, attributes) {

                var html = "";
                var exceptions = ["Id", "isProcessed"];

                for (n in fields) {

                    var field = attributes[fields[n]];
                    var name = fields[n];

                    if (field != null) {

                        var required = (field.Required != false) ? "required" : "";
                        var pattern = (!!isNotEmpty(field.Pattern)) ? "pattern='" + field.Pattern + "'" : "";
                        var label = (!!isNotEmpty(field.Label)) ? "<label class='text-white' for='" + name + "' >" + field.Label + ((required.length > 0) ? " *" : "") + "</label>" : "";
                        var placeholder = field.Placeholder;
                        var type = field.Type.toLowerCase();

                        html += label + "<br>";
                        html += "<input  class='w-100'  name='" + name + "' type='" + type + "' " + pattern + " placeholder='" + placeholder + "' " + required + ">" + "<br>";

                    } else if (!inArray(exceptions, name)) {

                        html += "<label for='" + name + "' >" + name + "</label>" + "<br>";
                        html += "<input   class='w-100' name='" + name + "' type='text'>" + "<br>";

                    }

                }

                return html;
            }

            function getFieldNames(de_name) {

                var out = [];
                var attr = DataExtension.Retrieve({ Property: "Name", SimpleOperator: "equals", Value: de_name });
                var de = DataExtension.Init(attr[0].CustomerKey);
                var fields = de.Fields.Retrieve();

                if (fields.length > 0) {
                    fields.sort(function (a, b) { return (a.Ordinal > b.Ordinal) ? 1 : -1 });
                    for (k in fields) {
                        if (!strStartsWith(fields[k].Name, "_") && fields[k].Name.toLowerCase() !== "id") out = out.concat(fields[k].Name);
                    }
                }

                return out;

            }

            function splitKeysValues(fields) {

                var out = {
                    "Keys": [],
                    "Values": []
                }
                for (k in fields) {
                    var v = fields[k];
                    out.Keys.push(k);
                    out.Values.push(v);
                }
                return out;
            }

            function getPageURL() {

                var page = Platform.Request.RequestURL;

                if (page.indexOf("?") > 0) {
                    var out = page.substring(0, page.indexOf("?"));
                } else {
                    var out = page;
                }

                return out;
            }

            function strStartsWith(str, search, pos) {
                pos = !pos || pos < 0 ? 0 : +pos;
                return str.substring(pos, pos + search.length) === search;
            }

            function inArray(arr, k) {
                var out = -1;
                for (var i in arr) {
                    if (arr[i] == k) out = i;
                }
                return out;
            }

            function isNotEmpty(val) {
                return (val != null && val.length > 0);
            }

            function timestamp() {

                var now = new Date();
                var out = now.getFullYear()
                    + addZero(now.getMonth() + 1)
                    + addZero(now.getDate())
                    + addZero(now.getHours())
                    + addZero(now.getMinutes())
                    + addZero(now.getSeconds())
                    + random(100, 999);
                return out;

                function addZero(n) {
                    return n < 10 ? '0' + n : n
                }

                function random(min, max) {
                    min = Math.ceil(min);
                    max = Math.floor(max);
                    return Math.floor(Math.random() * (max - min)) + min;
                }

            }

        </script>

    </section>

    <footer class=" text-center bg-info text-white  d-flex align-items-center justify-content-center navbar fixed-bottom ">
        <div>
            Â©mm
        </div>
    </footer>





</body>

</html>